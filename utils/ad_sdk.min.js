const{appId:appId,appSecret:appSecret,appKey:appKey}=require("ad_conf.js");const md5=require("ad_md5.min.js");let initData={appkey:appKey,adslot:"",appid:appId,secret:appSecret,code:"",brand:"",model:"",system:"",city:"",province:"",country:"",gender:""};let status={uInfo:true,sInfo:true};function req(e,t,n){return new Promise((i,o)=>{wx.request({url:"http://192.168.1.199/Api/"+e,data:t,method:n,success:e=>{if(e.statusCode!=200){o(e);return false}i(e.data)},fail:function(e){o(e)}})})}function login(){return new Promise((e,t)=>{wx.login({success:function(t){e(t)},fail:function(e){console.warn(e)}})})}function getU(){return new Promise((e,t)=>{wx.getSetting({success:t=>{if(t.authSetting["scope.userInfo"]){wx.getUserInfo({success:t=>{var n=t.userInfo;initData.city=n.city;initData.province=n.province;initData.country=n.country;initData.gender=n.gender;e(t)},fail:function(e){console.warn(e)},complete:function(e){}})}else{status.uInfo=false;e(t)}},fail:function e(t){console.warn(t)}})})}function getS(){return new Promise((e,t)=>{wx.getSystemInfo({success:t=>{initData.brand=t.brand;initData.model=t.model;initData.system=t.system;status.sInfo=false;e()}})})}function objKeySort(e){var t=Object.keys(e).sort();var n="JTIzQCV1RkYwMSV1ODA1QSV1NzBCOSV1NEU5MiV1NTJBOCV1RYwMUAlMjM=";for(var i=0;i<t.length;i++){n+=t[i]+e[t[i]]}return md5.hexMD5(n)}function init(e,t){var n={},i;return login().then(e=>{i=e.code;return getU()}).then(e=>{return getS()}).then(o=>{n[t]=Object.assign({},initData);n[t].adslot=e;n[t].code=i;n[t].sign=objKeySort(n[t]);return req("request",n[t],"GET")}).then(e=>{return e.data},e=>{console.warn(e)})}function click(e){wx.request({url:e,method:"GET",success:function(e){},fail:function(e){}})}function close(e,t){t.setData({[e]:false})}module.exports={init:init,click:click,close:close};